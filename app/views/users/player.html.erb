<body id="black">
<main id="gray">
<script>
$(document).ready(function() {
	try {
		$('body').ripples({
			resolution: 512,
			dropRadius: 20,
            perturbance: 0.04,
            interactive: false
		});
		$('main').ripples({
			resolution: 128,
			dropRadius: 5s,
			perturbance: 0,
			interactive: false
		});
	}
	catch (e) {
		$('.error').show().text(e);
	}

    setInterval(function() {
		var $el = $('body');
		var x = Math.random() * $el.outerWidth();
		var y = Math.random() * $el.outerHeight();
		var dropRadius = 20;
		var strength = 0.04 + Math.random() * 0.04;

		$el.ripples('drop', x, y, dropRadius, strength);
	}, 400);

	setInterval(function() {
		var $el = $('main');
		var x = 100;
		var y = 100;
		var dropRadius = 10;
		var strength = 1

		$el.ripples('drop', x, y, dropRadius, strength);
    }, 400);
});
</script>
</main>
</body>

<script>
    var map, infoWindow, pos;
    
    function initMap() {
        var directionsService = new google.maps.DirectionsService();
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function (position) {
                pos = {
                    lat: position.coords.latitude,
                    lng: position.coords.longitude
                };
                
                console.log('lat: ', position.coords.latitude);
                console.log('lng: ', position.coords.longitude);

                calculateAndDisplayRoute(directionsService, pos);

            }, function () {
                handleLocationError(true);
            });
        } else {
            handleLocationError(false);
        }
    }

    function calculateAndDisplayRoute(directionsService, address) {        
        console.log('address: ', address)
        console.log('end:', '<%= current_user.end %>');

        directionsService.route({
            origin: pos,
            destination: '<%= current_user.end %>',
            travelMode: 'WALKING'
        }, function (response, status) {
            if (status === 'OK') {
                var distance = 0
                var route = response.routes[0]; 
                distance = route.legs[0].distance.value;
                
                console.log('destination', '<%= current_user.end %>')
                console.log('Distance: ', String(distance))

                console.log("Start:" + route.legs[0].start_address)
                console.log("End:" + route.legs[route.legs.length - 1].end_address)
                console.log("distance set:" + parseFloat(distance, 2))
        }
        });
    }

    function handleLocationError(browserHasGeolocation) {
        console.log("Error")
    }
</script>

<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDGCQhxjnRfnXNtqTYOkhebzXSPtc5KQnY&libraries=places&callback=initMap"></script>
<script type="app/assets/javascripts" src=“timedropper.js></script>
<script type="app/assets/stylesheets" src=“timedropper.css></script>

<div >
    <h2 id="time">現在時刻</h2>
    <h3>
    <% time = Time.now %>
    <% str = time.strftime("%H:%M")%>
        <%= "#{str}" %>
    </h3>
</div>
<div class="btn_container">
    <input type="submit" value="停止" class="btn btn-primary btn-lg'">
    <input type="submit" value="曲送り" class="btn btn-primary btn-lg'">
</div>